# Главное

Расширение конфигурации 1С:ERP для загрузки данных посещения сотрудников из внешних систем, а также последующего контроля введенного рабочего времени по сотрудникам. Проверено на релизе 2.4.13.71.

## Принцип работы

В 1С из внешней системы загружаются данные прихода и ухода сотрудников, на основании чего вычситывается время их присутствия на рабочем месте. Далее при заполнении табеля часы явки перезаполняется данными фактического присутствия сотрудников, но без учета сверхурочных (их учет ведется отдельно). При этом считается, что каждое отклонение рабочего времени сотрудника от его нормы должно быть обосновано и зафиксировано в системе. Т.е. если сотрудник по какой-либо причине отработал меньше суточной нормы, то неотработанные часы необходимо обосновать - ввести документ, регистрирующий причину отсутствия сотрудника. Это может быть отпуск, больничный, отгул и т.д. В рамках месяца устанавливается лимит допустимых часов отсутствия сотрудников без указания их обоснований, а также высчитывается статус заполнения рабочего времени по сотруднику:

- Зеленый: у сотрудника за весь период нет необоснованных отсутствий
- Желтый: у сотрудника есть необоснованные отсутствия за период, но их общее число не превышает установленный лимит
- Красный: общее число необоснованных отсутствий сотрудника за период превышает установленный лимит

В случае наличия в табеле сотрудников с красным статусом, документ не проводится, а пользователю выдается соответствующее сообщение об ошибке заполнения.

## Подключение внешнего источника данных

Загрузка данных посещаемости сотрудников производится из внешнего источника данных Hikvision.

Настроить подключение к внешнему источнику можно из меню "Все функции" -> "Управление внешними источниками данных" -> "Hikvision".

Пример строки подключения:

```
DRIVER={ODBC Driver 17 for SQL Server};SERVER=АДРЕС_СЕРВЕРА;DATABASE=ИМЯ_БАЗЫ_ДАННЫХ;UID=ПОЛЬЗОВАТЕЛЬ;PWD=ПАРОЛЬ
```

## Сопоставление сотрудников

В целях сопоставления сотрудников в 1С и во внешнем источнике данных, в карточке сотрудника необходимо заполнить значение реквизита "Идентификатор Hikvision".

![Идентификатор сотрудника в Hikvision](/images/image-1.png)

В данное поле необходимо заполнить значение из колонки "EmployeeID" базы данных Hikvision.

![База данных Hikvision](/images/image-2.png)

## Параметры контроля рабочего времени

Параметры контроля рабочего времени указываются в регистре сведений "Параметры контроля рабочего времени сотрудников", расположенном в подсистеме "Зарплата" -> "Учет времени".

![Параметры контроля рабочего времени](/images/image-3.png)

В разрезе периода и организации можно указать следующие настройки:

**Допустимые часы отсутствий без обоснований**

Итоговое количество необоснованных отсутствий сотрудника не должно превышать указанное в этой настройке значение. В противном случае при проведении табеля будет выдана ошибка с соответствующим сообщением.

**Точность округления**

Точность часов посещаемости, полученных из внешней системы. Округление происходит при заполнении табеля.

**Вариант округления**

Вариант округления часов посещения сотрудников. Допустимые значения:

- по арифметическим правилам
- в пользу сотрудника
- в пользу предприятия

Округление происходит при заполнении табеля.

## Посещаемость сотрудников

Загрузка информации времени прихода-ухода сотрудников осуществляется документом "Посещаемость сотрудников" (подсистема "Зарплата" -> "Учет времени".). В данном документе необходимо указать период регистрации, после чего нажать на кнопку "Заполнить из Hikvision".

![Документ посещаемости сотрудников](/images/image-4.png)

При активации ячейки табличной части документа можно просмотреть полную информацию о времени, когда были зафиксированны посещения сотрудников. Временем прихода сотрудника считается минимальное зафиксированное время посещения сотрудника, временем ухода - максимальное. Разница между этими датами считается временем присутствия сотрудника на рабочем месте.

Почему не используется информация о направлении входа-выхода сотрудника? Потому что во внешнем исчтонике данных оно представлено некорректно, а следовательно полагаться на него в текущих реалиях нельзя.

## Контроль ввода рабочего времени

![Документ табеля](/images/image-5.png)

При заполнении табеля явки сотрудников организации будут перезаполнены в соответствии с данными, введенными в документе "Посещаемость сотрудников". При этом переработка (сверхурочные) учитываться не будут, т.е. максимальное значение явки равно норме времени за день. К часам явки будут применены правила округления, указанные в регистре параметров контроля рабочего времени.

В табличную часть документа добавлены три новые информативные колонки:

- итоговое число нормативных часов сотрудника за период
- количество обоснованных часов, т.е. таких часов по которым указан вид рабочего времени.
- количество необоснованных часов. Это разница между нормой часов за период и количеством обоснованных часов.

Если количество необоснованных часов сотрудника превышает установленное допустимое значение, то при попытке провести документ будет выведено соответствующее сообщение об ошибке. При этом нужно учесть, что число допустимых необоснованных часов рассчитывается пропорционально периоду, за который вводится табель. Например, если в регистре указано, что течение месяц допустимы 3 часа необоснованных отсутствий, то при заполнении табеля за период с 01.09.2024 по 15.09.2024 допустимыми окажутся только 1.5 часа:

```
3 / 30 * 15 = 1.5
```

Общее количество допустимых часов без обоснования можно посмотреть в подвале формы. Здесь же выводится и информация по посещаемости за конкретный день табеля по сотруднику - для вывода данных нужно активизировать соответствующую ячейку.

## Отчет

![Отчет](/images/image-6.png)

Отчет "Контроль рабочего времени сотрудников" позволяет просмотреть информацию, аналогичную той, что выводится и в документе табеля. Дополнительно выводится кадровая информация по сотруднику (подразделение, должность), а также конкретное время прихода-ухода за каждый день периода. Доступна расшифровка по виду рабочего времени.

Отчет располагается в подсистеме "Зарплата" -> "Отчеты по зарплате".

## Освобождение от контроля посещаемости

![Освобождение от контроля посещаемости](/images/image-7.png)

Реализована возможность освобождения сотрудника от контроля посещаемости на определенный период. Для этого нужно ввести документ "Освобождение от контроля посещаемости". В этом случае при заполнении табеля часы явки сотрудника не будут переопределяться данными, полученными из внешней системы.
