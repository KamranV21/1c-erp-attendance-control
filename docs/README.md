# Главное

Расширение конфигурации 1С:ERP для загрузки данных посещения сотрудников из внешних систем, а также последующего контроля введенного рабочего времени по сотрудникам. Проверено на релизе 2.4.13.71.

## Принцип работы

В 1С из внешней системы загружаются данные прихода и ухода сотрудников, на основании чего вычситывается время их присутствия на рабочем месте. Далее при заполнении табеля часы явки перезаполняется данными фактического присутствия сотрудников, но без учета сверхурочных (их учет ведется отдельно). При этом считается, что каждое отклонение рабочего времени сотрудника от его нормы должно быть обосновано и зафиксировано в системе. Т.е. если сотрудник по какой-либо причине отработал меньше суточной нормы, то неотработанные часы необходимо обосновать - ввести документ, регистрирующий причину отсутствия сотрудника. Это может быть отпуск, больничный, отгул и т.д. В рамках месяца устанавливается лимит допустимых часов отсутствия сотрудников без указания их обоснований, а также высчитывается статус заполнения рабочего времени по сотруднику:

- Зеленый: у сотрудника за весь период нет необоснованных отсутствий
- Желтый: у сотрудника есть необоснованные отсутствия за период, но их общее число не превышает установленный лимит
- Красный: общее число необоснованных отсутствий сотрудника за период превышает установленный лимит

В случае наличия в табеле сотрудников с красным статусом, документ не проводится, а пользователю выдается соответствующее сообщение об ошибке заполнения.

## Подключение внешнего источника данных

Загрузка данных посещаемости сотрудников производится из внешнего источника данных Hikvision.

Настроить подключение к внешнему источнику можно из меню "Все функции" -> "Управление внешними источниками данных" -> "Hikvision".

Пример строки подключения:

```
DRIVER={ODBC Driver 17 for SQL Server};SERVER=АДРЕС_СЕРВЕРА;DATABASE=ИМЯ_БАЗЫ_ДАННЫХ;UID=ПОЛЬЗОВАТЕЛЬ;PWD=ПАРОЛЬ
```

## Сопоставление сотрудников

В целях сопоставления сотрудников в 1С и во внешнем источнике данных, в карточке сотрудника необходимо заполнить значение реквизита "Идентификатор Hikvision".

![Идентификатор сотрудника в Hikvision](/images/image-1.png)

В данное поле необходимо заполнить значение из колонки "EmployeeID" базы данных Hikvision.

![База данных Hikvision](/images/image-2.png)

## Параметры контроля рабочего времени

Параметры контроля рабочего времени указываются в регистре сведений "Параметры контроля рабочего времени сотрудников", расположенном в подсистеме "Зарплата" -> "Учет времени".

![Параметры контроля рабочего времени](/images/image-3.png)

В разрезе периода и организации можно указать следующие настройки:

**Допустимые часы отсутствий без обоснований**

Итоговое количество необоснованных отсутствий сотрудника не должно превышать указанное в этой настройке значение. В противном случае при проведении табеля будет выдана ошибка с соответствующим сообщением.

**Допустимые часы отсутствий без обоснований**

Точность часов посещаемости, полученных из внешней системы. Округление происходит при заполнении табеля.

**Вариант округления**

Вариант округления часов посещения сотрудников. Допустимые значения:

- по арифметическим правилам
- в пользу сотрудника
- в пользу предприятия

Округление происходит при заполнении табеля.

## Посещаемость сотрудников

Загрузка информации времени прихода-ухода сотрудников осуществляется документом "Посещаемость сотрудников" (подсистема "Зарплата" -> "Учет времени".). В данном документе необходимо указать период регистрации, после чего нажать на кнопку "Заполнить из Hikvision".

![Документ посещаемости сотрудников](/images/image-4.png)

При активации ячейки табличной части документа можно просмотреть полную информацию о времени, когда были зафиксированны посещения сотрудников. Временем прихода сотрудника считается минимальное зафиксированное время посещения сотрудника, временем ухода - максимальное. Разница между этими датами считается временем присутствия сотрудника на рабочем месте.

Почему не используется информация о направлении входа-выхода сотрудника? Потому что во внешнем исчтонике данных оно представлено некорректно, а следовательно полагаться на него в текущих реалиях нельзя.

## Контроль ввода рабочего времени

![Документ табеля](/images/image-5.png)

## Отчет

...

## Освобождение от контроля посещаемости

...
